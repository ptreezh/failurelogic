<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹çˆ±å…³ç³»æ—¶é—´å»¶è¿Ÿ - é›†æˆæµ‹è¯•</title>

    <!-- CSS -->
    <link rel="stylesheet" href="assets/css/normalize.css">
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/game-styles.css">
    <link rel="stylesheet" href="assets/css/turn-based-game.css">
    <link rel="stylesheet" href="assets/css/scenarios/relationship-time-delay.css">

    <style>
        body {
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            color: #e91e63;
            margin-bottom: 15px;
        }
        .test-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        #game-container {
            min-height: 400px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª æ‹çˆ±å…³ç³»æ—¶é—´å»¶è¿Ÿ - é›†æˆæµ‹è¯•</h1>

    <div class="test-section">
        <h2>æµ‹è¯•åœºæ™¯åŠŸèƒ½</h2>
        <div class="test-buttons">
            <button class="btn btn-primary" onclick="testScenarioLoad()">
                1. æµ‹è¯•åœºæ™¯åŠ è½½
            </button>
            <button class="btn btn-secondary" onclick="testRouterInit()">
                2. æµ‹è¯•Routeråˆå§‹åŒ–
            </button>
            <button class="btn btn-secondary" onclick="testGameFlow()">
                3. æµ‹è¯•æ¸¸æˆæµç¨‹
            </button>
            <button class="btn btn-tertiary" onclick="clearGame()">
                æ¸…é™¤æ¸¸æˆ
            </button>
        </div>
    </div>

    <div id="game-container"></div>

    <div class="test-section">
        <h2>æµ‹è¯•ç»“æœ</h2>
        <div id="test-results"></div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/api-config-manager.js"></script>
    <script src="assets/js/app.js"></script>

    <script>
        // Test results container
        const resultsDiv = document.getElementById('test-results');

        function logResult(message, success = true) {
            const color = success ? '#4caf50' : '#f44336';
            const icon = success ? 'âœ“' : 'âœ—';
            resultsDiv.innerHTML += `<p style="color: ${color};">${icon} ${message}</p>`;
        }

        function testScenarioLoad() {
            try {
                logResult('å¼€å§‹æµ‹è¯•åœºæ™¯åŠ è½½...', true);

                // Test 1: Check if class is defined
                if (typeof RelationshipTimeDelayPageRouter === 'undefined') {
                    logResult('âŒ RelationshipTimeDelayPageRouter class not found', false);
                    return;
                }
                logResult('âœ“ RelationshipTimeDelayPageRouter class is defined', true);

                // Test 2: Check if start method exists
                const router = new RelationshipTimeDelayPageRouter();
                logResult('âœ“ Router instance created successfully', true);

                // Test 3: Check initial state
                if (router.currentPage !== 'START') {
                    logResult(`âŒ Initial page is ${router.currentPage}, expected START`, false);
                    return;
                }
                logResult('âœ“ Router starts at START page', true);

                // Test 4: Check game state
                if (router.gameState.affection !== 50) {
                    logResult(`âŒ Initial affection is ${router.gameState.affection}, expected 50`, false);
                    return;
                }
                logResult('âœ“ Initial game state is correct', true);

                logResult('âœ… åœºæ™¯åŠ è½½æµ‹è¯•é€šè¿‡ï¼', true);

            } catch (error) {
                logResult(`âŒ åœºæ™¯åŠ è½½æµ‹è¯•å¤±è´¥: ${error.message}`, false);
                console.error(error);
            }
        }

        function testRouterInit() {
            try {
                logResult('å¼€å§‹æµ‹è¯•Routeråˆå§‹åŒ–...', true);

                const router = new RelationshipTimeDelayPageRouter();

                // Test page flow
                router.startGame();
                if (router.currentPage !== 'TURN_1_DECISION_1') {
                    logResult(`âŒ After startGame, page is ${router.currentPage}, expected TURN_1_DECISION_1`, false);
                    return;
                }
                logResult('âœ“ startGame() transitions correctly', true);

                // Test decision making
                router.makeDecision('communication_style', 'medium');
                if (router.currentPage !== 'TURN_1_DECISION_1_FEEDBACK') {
                    logResult(`âŒ After makeDecision, page is ${router.currentPage}, expected FEEDBACK`, false);
                    return;
                }
                logResult('âœ“ makeDecision() works correctly', true);

                // Test pending effect system
                const initialPending = router.gameState.pending_effects.length;
                router.queueDecisionEffect('dating_frequency', 'twice_weekly', 1);
                if (router.gameState.pending_effects.length !== initialPending + 1) {
                    logResult(`âŒ queueDecisionEffect failed to add effect`, false);
                    return;
                }
                logResult('âœ“ PendingEffect system works', true);

                logResult('âœ… Routeråˆå§‹åŒ–æµ‹è¯•é€šè¿‡ï¼', true);

            } catch (error) {
                logResult(`âŒ Routeråˆå§‹åŒ–æµ‹è¯•å¤±è´¥: ${error.message}`, false);
                console.error(error);
            }
        }

        function testGameFlow() {
            try {
                logResult('å¼€å§‹æµ‹è¯•å®Œæ•´æ¸¸æˆæµç¨‹...', true);

                // Start the game
                GameManager.startRelationshipTimeDelayGame();

                setTimeout(() => {
                    // Check if game modal is shown
                    const modal = document.getElementById('game-modal');
                    if (!modal) {
                        logResult('âŒ Game modal not found', false);
                        return;
                    }

                    if (modal.style.display === 'none' || modal.style.display === '') {
                        logResult('âŒ Game modal is not visible', false);
                        return;
                    }
                    logResult('âœ“ Game modal is displayed', true);

                    // Check if content is rendered
                    const container = document.getElementById('game-container');
                    if (!container) {
                        logResult('âŒ Game container not found', false);
                        return;
                    }

                    const hasContent = container.innerHTML.length > 100;
                    if (!hasContent) {
                        logResult('âŒ Game container is empty', false);
                        return;
                    }
                    logResult('âœ“ Game content is rendered', true);

                    logResult('âœ… æ¸¸æˆæµç¨‹æµ‹è¯•é€šè¿‡ï¼', true);

                }, 500);

            } catch (error) {
                logResult(`âŒ æ¸¸æˆæµç¨‹æµ‹è¯•å¤±è´¥: ${error.message}`, false);
                console.error(error);
            }
        }

        function clearGame() {
            try {
                // Close modal if open
                const modal = document.getElementById('game-modal');
                if (modal) {
                    modal.style.display = 'none';
                }

                // Clear router
                if (window.relationshipTimeDelayRouter) {
                    window.relationshipTimeDelayRouter = null;
                }

                // Clear container
                const container = document.getElementById('game-container');
                if (container) {
                    container.innerHTML = '<p>æ¸¸æˆå·²æ¸…é™¤ã€‚ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®é‡æ–°å¼€å§‹æµ‹è¯•ã€‚</p>';
                }

                resultsDiv.innerHTML = '<p>æµ‹è¯•ç»“æœå·²æ¸…é™¤ã€‚</p>';

            } catch (error) {
                logResult(`âŒ æ¸…é™¤æ¸¸æˆå¤±è´¥: ${error.message}`, false);
            }
        }

        // Auto-run test on page load
        window.addEventListener('load', () => {
            logResult('é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡æµ‹è¯•', true);
            logResult('ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•', true);
        });
    </script>
</body>
</html>
